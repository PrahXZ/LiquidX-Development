package net.ccbluex.liquidbounce.features.module.modules.exploit.disablers.other

import net.ccbluex.liquidbounce.event.PacketEvent
import net.ccbluex.liquidbounce.features.module.modules.exploit.disablers.DisablerMode
import net.ccbluex.liquidbounce.utils.PacketUtils
import net.minecraft.network.play.client.C03PacketPlayer
import net.minecraft.network.play.server.S08PacketPlayerPosLook

class VanillaDesyncDisabler : DisablerMode("VanillaDesync") {

    override fun onPacket(event: PacketEvent) {
        val packet = event.packet
        if (packet is S08PacketPlayerPosLook) {
            if (!mc.netHandler.doneLoadingTerrain) {
                disabler.debugMessage("Not loaded terrain yet")
                return
            }
            event.cancelEvent()
            PacketUtils.sendPacketNoEvent(C03PacketPlayer.C04PacketPlayerPosition(packet.x, packet.y, packet.z, false))
            mc.thePlayer.setPosition(packet.x, packet.y, packet.z)
            disabler.debugMessage("Silent setback")
        }
    }
}